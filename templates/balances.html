{% extends 'base.html' %}
{% block title %}Balances{% endblock %}
{% block content %}
<h1>Your Balances</h1>

<h2>Your Monero subaddress</h2>
{% if monero_address %}
<p style="word-break: break-all;">{{ monero_address }}</p>
{% else %}
<p style="color:#555;">No subaddress yet for your account.</p>
{% endif %}
<form method="post" action="{{ url_for('rotate_address') }}" style="margin:8px 0;">
  <button type="submit">Create a new subaddress</button>
  <span style="color:#555; font-size:0.9em;">Old subaddresses will be disabled and cleaned up after ~1 day if empty.</span>
</form>

{% if balance %}
<table border="1" cellpadding="6" cellspacing="0">
  <tr><th align="left">User ID</th><td>{{ balance.user_id }}</td></tr>
  <tr><th align="left">Fake XMR (in DB)</th><td>{{ ('%.10f' % balance.fake_xmr).rstrip('0').rstrip('.') }}</td></tr>
  <tr><th align="left">Real XMR (external)</th><td>{{ ('%.10f' % balance.real_xmr).rstrip('0').rstrip('.') }}</td></tr>
  <tr><th align="left">Updated</th><td>{{ balance.updated_at }}</td></tr>
</table>
{% else %}
<p>Balance not available.</p>
{% endif %}

<h2>Increase Balance</h2>
<form method="post" action="{{ url_for('balances_increase') }}" style="display:flex;gap:8px;align-items:end;">
  <label>Kind
    <select name="kind">
      <option value="fake">Fake</option>
      <option value="real">Real</option>
    </select>
  </label>
  <label>Amount (XMR)
    <input type="number" name="amount_xmr" step="0.0000000001" min="0" required>
  </label>
  <button type="submit">Increase</button>
</form>

<h2>Decrease Balance</h2>
<form method="post" action="{{ url_for('balances_decrease') }}" style="display:flex;gap:8px;align-items:end;">
  <label>Kind
    <select name="kind">
      <option value="fake">Fake</option>
      <option value="real">Real</option>
    </select>
  </label>
  <label>Amount (XMR)
    <input type="number" name="amount_xmr" step="0.0000000001" min="0" required>
  </label>
  <button type="submit">Decrease</button>
</form>

<h2>Withdraw (Send Monero)</h2>
<form method="post" action="{{ url_for('balances_withdraw') }}" style="display:flex;gap:8px;align-items:end;flex-wrap:wrap;">
  <label style="flex:1 1 420px;">Destination Address
    <input type="text" name="to_address" style="width:100%;" required>
  </label>
  <label>Amount (XMR)
    <input type="number" name="amount_xmr" step="0.0000000001" min="0" required>
  </label>
  <button type="submit">Send</button>
</form>
<p style="color:#555;max-width:720px;">
  Note: You cannot withdraw more than your total balance (Fake XMR + Real XMR). The system will enforce this limit server-side.
</p>
{% endblock %}
