<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Pupero Frontend{% endblock %}</title>
    <style>
      :root {
        --header-bg: #f8f9fb;
        --header-border: #e5e7eb;
        --link: #0d6efd;
        --link-hover: #0b5ed7;
      }
      html, body { margin: 0; padding: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
      a { color: var(--link); text-decoration: none; }
      a:hover { color: var(--link-hover); text-decoration: underline; }
      .site-header { position: sticky; top: 0; z-index: 100; background: var(--header-bg); border-bottom: 1px solid var(--header-border); }
      .nav-inner { max-width: 1100px; margin: 0 auto; padding: 10px 16px; display: flex; align-items: center; gap: 16px; }
      .brand { display: flex; align-items: center; gap: 10px; min-width: 0; }
      .brand img { height: 36px; width: auto; display: block; }
      .brand-title { font-weight: 600; color: #111827; white-space: nowrap; }
      .spacer { flex: 1; }
      .nav-links { display: flex; flex-wrap: wrap; gap: 10px 14px; align-items: center; }
      .flash { max-width: 1100px; margin: 8px auto; padding: 0 16px; }
      .flash ul { margin: 8px 0; padding: 8px 12px; background: #fff; border: 1px solid var(--header-border); border-radius: 6px; }
      .flash li { margin: 4px 0; }
      main { max-width: 1100px; margin: 12px auto 32px; padding: 0 16px; }
      @media (max-width: 640px) {
        .brand-title { display: none; }
        .brand img { height: 30px; }
      }
    </style>
</head>
<body>
    <header class="site-header">
      <div class="nav-inner">
        <a class="brand" href="{{ url_for('home') }}" aria-label="Pupero home">
          <img src="{{ url_for('static', filename='login_logo.png') }}" alt="Pupero Logo" onerror="this.style.display='none'">
          <span class="brand-title">Pupero</span>
        </a>
        <div class="spacer"></div>
        <nav class="nav-links" aria-label="Primary">
          <a href="{{ url_for('home') }}">Home</a>
          {% if request.cookies.get('access_token') %}
              <a href="{{ url_for('offers') }}">Offers</a>
              <a href="{{ url_for('rates') }}">Rates</a>
              <a href="{{ url_for('buy') }}">Buy</a>
              <a href="{{ url_for('sell') }}">Sell</a>
              <a href="{{ url_for('create_ad') }}">Create Ad</a>
              <a href="{{ url_for('my_ads') }}">My Ads</a>
              <a href="{{ url_for('profile') }}">Profile</a>
              <a href="{{ url_for('balances') }}">Balances</a>
              <a href="{{ url_for('trades_list') }}">My Trades</a>
              {% if active_trade_id %}<a href="{{ url_for('trade_current') }}"><strong>Active Trades</strong></a>{% endif %}
              {% if not totp_enabled %}<a href="{{ url_for('totp_enable') }}">Enable TOTP</a>{% endif %}
              <a href="{{ url_for('debug_isadmin_toggle') }}">Admin: {{ 'ON' if is_admin else 'OFF' }}</a>
              <a href="{{ url_for('logout') }}">Logout</a>
          {% else %}
              <a href="{{ url_for('register') }}">Register</a>
              <a href="{{ url_for('login') }}">Login</a>
              <a href="{{ url_for('password_reset') }}">Reset Password</a>
              <a href="{{ url_for('rates') }}">Rates</a>
              <a href="{{ url_for('debug_isadmin_toggle') }}">Admin: {{ 'ON' if is_admin else 'OFF' }}</a>
          {% endif %}
        </nav>
      </div>
    </header>

    {% if is_admin %}
    <div style="background:#222;color:#fff;padding:4px 8px;margin:6px 0;">Admin mode is ON (debug)</div>
    {% endif %}

    <div class="flash">
      {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
              <ul>
                  {% for category, message in messages %}
                      <li class="{{ category }}">{{ message }}</li>
                  {% endfor %}
              </ul>
          {% endif %}
      {% endwith %}
    </div>

    <main>
      {% block content %}{% endblock %}
    </main>
</body>
</html>
